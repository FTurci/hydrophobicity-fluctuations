# Coarse-grain water simulation using Stillinger-Weber
units		    real
atom_style	    atomic


variable        N index on      # Newton Setting
variable        w index 10      # Warmup Timesteps
variable        t index 50000	# Main Run Timesteps
variable        m index 10       # Main Run Timestep Multiplier
variable        n index 0       # Use NUMA Mapping for Multi-Node
# variable        p index 0       # Use Power Measurement

variable        T equal  426
variable        betamu equal -10.66336
variable        boltzmannK equal 1.987204259*0.001 #kcal/K/mol
variable        mu equal ${betamu}*${T}*${boltzmannK}

variable mwMass equal 18.015 
variable boltz equal 0.0019872067
variable hplanck  equal 95.306976368
variable mvv2e equal 48.88821291*48.88821291
variable lambda equal sqrt(${hplanck}*${hplanck}/(2.0*PI*${mwMass}*${mvv2e}*${boltz}*${T}))

# variable mu equal (${betamu}+3*ln(${lambda}))/(${T}*${boltz})

variable        runsteps equal floor($t*$m)

# newton          $N
# if "$n > 0"     then "processors * * * grid numa"


read_data	onlyWater.start
replicate 2 2 2


# change_box all x scale 0.5 y scale 0.5 z scale 0.5

reset_timestep	0

pair_style	sw
pair_coeff	* * mW.sw mW
# pair_style      lj/cut 3.0
# pair_modify     tail no # turn of to avoid triggering full_energy

# pair_coeff      * * 1.0 1.0
# mass            * 1.0


mass		1 ${mwMass}

#g/mol

# group		mW type 1


neighbor	2 bin #Angstroms
neigh_modify	every 1 delay 4
# zero the momentum
# velocity	mW zero linear
group           gcmcgroup type 1

timestep 0.2

# group       mW type 1
compute mdtemp gcmcgroup temp
compute_modify mdtemp dynamic/dof yes

variable        disp index 1.0

variable        n1 equal count(gcmcgroup)
variable        rho1 equal count(gcmcgroup)
print ":: mu is ${mu} lambda ${lambda}"
fix             mygcmc gcmcgroup gcmc 1 100 0 1 12345 ${T} ${mu} ${disp} 

# fix mygcmc mW  gcmc 100 100 200 1 29494 ${T} ${mu} 1.0 
# fix mygcmc all  gcmc 100 100 10 1 54341 ${T} ${mu} 1.0 full_energy 

#${disp} #mol h2omol tfac_insert ${tfac} group h2o shake wshake
fix	mdnvt gcmcgroup nvt temp ${T} ${T} 20
fix_modify mdnvt temp mdtemp 
# displace 5.0
# timestep	.5

thermo		100
compute_modify  thermo_temp dynamic/dof yes
thermo		100
compute_modify  thermo_press dynamic/dof yes
thermo_style custom step temp pe etotal press vol density v_rho1 

dump mydump all atom 500 tj-gcmc.atom

variable csvname string output.csv
fix extra all print 100 "$(step),$(pe),$(temp),$(press),$(density),$(v_rho1),$(vol)" file ${csvname} screen no title "step,epair,temperature,pressure,density,num,volume"


run		${runsteps}